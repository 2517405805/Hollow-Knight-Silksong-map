<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silksong 互动地图</title>
    <!-- 引用 CSS 文件 -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="map-container">
        <!-- 请确保 map.avif 文件在同级目录下 -->
        <img id="game-map" src="map.avif" alt="丝之歌地图">
        <!-- 画布：用于画父子连线和路径记录 -->
        <canvas id="lines-canvas"></canvas>
    </div>
    <div id="tooltip"></div>
    <div id="global-tip"></div>
    <!-- 标记弹窗 -->
    <div id="marker-dialog">
        <h3>添加/编辑</h3>
        <div class="type-toggle-group">
            <button id="btn-type-icon" class="type-btn active">图标模式</button>
            <button id="btn-type-wall" class="type-btn">墙/门模式</button>
        </div>
        <input type="text" id="dialog-name" placeholder="请输入名称" aria-label="名称">
        <textarea id="dialog-intro" rows="2" placeholder="简介（可选）" aria-label="简介"></textarea>
        <div class="coord-row">
            <input type="number" id="dialog-x" placeholder="X坐标" aria-label="X坐标">
            <input type="number" id="dialog-y" placeholder="Y坐标" aria-label="Y坐标">
        </div>
        <select id="dialog-layer" aria-label="所属图层">
            <option value="1">属于：第一幕</option>
            <option value="2">属于：第二幕</option>
            <option value="3">属于：第三幕</option>
        </select>
        <!-- 区域A：图标选择 -->
        <div id="panel-icon-select" class="icon-selector-row">
            <img id="dialog-icon-preview" src="" alt="预览">
            <select id="dialog-icon-select" aria-label="选择图标"></select>
        </div>
        <!-- 区域B：墙体参数 -->
        <div id="panel-wall-select">
            <div id="wall-type-toggle" class="sub-toggle-group">
                <button id="btn-wall-breakable" class="sub-type-btn active">易碎</button>
                <button id="btn-wall-oneway" class="sub-type-btn">单向</button>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
                <label for="dialog-wall-len">长度:</label>
                <input type="number" id="dialog-wall-len" style="margin:0; flex:1;">
                <label for="dialog-wall-angle">朝向:</label>
                <select id="dialog-wall-angle" style="margin:0; flex:1;">
                    <option value="270">左</option>
                    <option value="90">右</option>
                    <option value="0">上</option>
                    <option value="180">下</option>
                </select>
            </div>
        </div>
        <div class="dialog-buttons">
            <button id="btn-ok">确定</button>
            <button id="btn-cancel">取消</button>
        </div>
    </div>
    <div id="dialog-overlay"></div>
    <button id="btn-show-control" class="floating-btn left" title="展开菜单">☰</button>
    <button id="btn-show-path" class="floating-btn right" title="展开路径">☰</button>
    <!-- 左侧控制面板 -->
    <div id="control-panel" class="side-panel left">
        <div class="panel-header">
            <h3>功能菜单</h3>
            <button id="btn-hide-control" class="btn-minimize" title="收起">◀</button>
        </div>
        <div class="panel-row search-row">
            <input type="text" id="search-input" placeholder="搜索标记..." aria-label="搜索标记">
            <button id="btn-search-clear" title="清除搜索">✖</button>
        </div>
        <div id="layer-controls">
            <div class="panel-row">
                <button class="layer-btn active" data-layer="1">第一幕</button>
                <button class="layer-reset-btn" data-layer="1" title="重置透明度">重置</button>
            </div>
            <div class="panel-row">
                <button class="layer-btn active" data-layer="2">第二幕</button>
                <button class="layer-reset-btn" data-layer="2" title="重置透明度">重置</button>
            </div>
            <div class="panel-row">
                <button class="layer-btn active" data-layer="3">第三幕</button>
                <button class="layer-reset-btn" data-layer="3" title="重置透明度">重置</button>
            </div>
        </div>
        <h3>标记类型</h3>
        <hr>
        <div id="icon-controls"></div>
        <h3>功能按钮</h3>
        <hr>
        <div class="io-btn-group">
            <button id="btn-import">导入</button>
            <button id="btn-export">导出</button>
            <button id="btn-toggle-walls" class="toggle-sub-btn">显示墙体</button>
            <button id="btn-toggle-dimmed" class="toggle-sub-btn">隐藏已完成</button>
            <button id="btn-clear">删除</button>
        </div>
        <input type="file" id="file-input" style="display: none;" accept=".json">
    </div>
    <!-- 路径记录面板 -->
    <div id="path-panel" class="side-panel right collapsed">
        <div class="panel-header">
            <h3>路径记录</h3>
            <button id="btn-hide-path" class="btn-minimize" title="收起">◀</button>
        </div>
        <div class="panel-row" style="margin-bottom: 10px;">
            <button id="btn-path-toggle">▶ 开始记录</button>
            <button id="btn-path-autohide" class="toggle-sub-btn active">隐藏标记</button>
        </div>
        <div class="path-list-container">
            <ul id="path-list">
                <li>(暂无记录)</li>
            </ul>
        </div>
        <div class="path-actions-bottom">
            <div class="path-actions">
                <button id="btn-path-import">导入 JSON</button>
                <button id="btn-path-export">导出 JSON</button>
                <button id="btn-path-undo">撤销</button>
                <button id="btn-path-clear">清空</button>
            </div>
            <input type="file" id="path-file-input" style="display: none;" accept=".json">
        </div>
    </div>
    <!-- 右键菜单 -->
    <div id="context-menu">
        <div class="menu-item" id="menu-edit">编辑标记</div>
        <div class="menu-item" id="menu-move">移动位置</div>
        <div class="menu-item" id="menu-bind">绑定父标记</div>
        <div class="menu-item" id="menu-unbind">取消绑定</div>
        <div class="menu-item" id="menu-delete">删除标记</div>
    </div>
    <!-- 引用 JS -->
    <script src="script.js"></script>
</body>
</html>